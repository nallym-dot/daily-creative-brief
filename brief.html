<script>
  const WEBHOOK_URL = 'https://nallym.app.n8n.cloud/webhook/233c5fb1-5d05-41cf-b786-6e63a5efd06e';

  document.getElementById('footerDate').textContent =
    new Date().toLocaleDateString('en-IE', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

  async function getBrief() {
    const btn = document.getElementById('btn');
    const briefContainer = document.getElementById('briefContainer');
    const briefBody = document.getElementById('briefBody');
    const briefDate = document.getElementById('briefDate');
    const errorMsg = document.getElementById('errorMsg');

    btn.disabled = true;
    btn.classList.add('loading');
    briefContainer.classList.remove('visible');
    errorMsg.classList.remove('visible');

    try {
      const res = await fetch(WEBHOOK_URL, {
        method: 'POST'
      });

      if (!res.ok) throw new Error('Request failed');

      const text = await res.text();
      const formatted = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

      briefBody.innerHTML = formatted;
      briefDate.textContent =
        new Date().toLocaleTimeString('en-IE', {
          hour: '2-digit',
          minute: '2-digit'
        });

      briefContainer.classList.add('visible');

    } catch (err) {
      errorMsg.classList.add('visible');
    } finally {
      btn.disabled = false;
      btn.classList.remove('loading');
    }
  }
</script>
